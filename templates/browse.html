{% extends "base.html" %}

{% block title %}Browse Users - Skill Swap{% endblock %}

{% block additional_css %}
<style>
    .browse-container {
        padding: 2rem 0;
        min-height: 100vh;
    }
    
    .browse-header {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    .browse-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: var(--gradient-primary);
    }
    
    .browse-title {
        font-size: 2.5rem;
        font-weight: 700;
        background: var(--gradient-primary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
        text-align: center;
    }
    
    .browse-subtitle {
        text-align: center;
        color: var(--text-secondary);
        font-size: 1.1rem;
        margin-bottom: 2rem;
    }
    
    .search-filters-section {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        position: sticky;
        top: 100px;
        z-index: 100;
    }
    
    .search-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .search-input-wrapper {
        position: relative;
    }
    
    .search-input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        border: 1px solid var(--border-color);
        border-radius: 15px;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        color: var(--text-primary);
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        transform: translateY(-2px);
    }
    
    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary-color);
        font-size: 1.1rem;
    }
    
    .search-btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 15px;
        background: var(--gradient-primary);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        white-space: nowrap;
    }
    
    .search-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
    }
    
    .search-btn:hover::before {
        left: 100%;
    }
    
    .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);
    }
    
    .filters-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-label {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .filter-select {
        padding: 0.75rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .filter-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    
    .results-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1rem 0;
    }
    
    .results-count {
        font-size: 1rem;
        color: var(--text-secondary);
    }
    
    .results-count strong {
        color: var(--primary-color);
    }
    
    .view-toggle {
        display: flex;
        gap: 0.5rem;
    }
    
    .view-btn {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 8px;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .view-btn.active {
        background: var(--gradient-primary);
        color: white;
        border-color: var(--primary-color);
    }
    
    .view-btn:hover {
        transform: translateY(-2px);
    }
    
    .users-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }
    
    .users-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 3rem;
    }
    
    .user-card {
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 2rem;
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
        cursor: pointer;
        opacity: 0;
        transform: translateY(30px);
    }
    
    .user-card.visible {
        opacity: 1;
        transform: translateY(0);
    }
    
    .user-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--gradient-primary);
        opacity: 0.05;
        transition: left 0.3s ease;
    }
    
    .user-card:hover::before {
        left: 0;
    }
    
    .user-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-heavy);
        border-color: var(--primary-color);
    }
    
    .glow-card {
        position: relative;
    }
    
    .glow-card::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: var(--gradient-primary);
        border-radius: inherit;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
        filter: blur(15px);
    }
    
    .glow-card:hover::after {
        opacity: 0.4;
    }
    
    .user-header {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .user-avatar {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid var(--primary-color);
        margin-right: 1rem;
        transition: all 0.3s ease;
    }
    
    .user-avatar:hover {
        transform: scale(1.1);
        box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);
    }
    
    .user-avatar-placeholder {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        background: var(--gradient-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.8rem;
        font-weight: 700;
        margin-right: 1rem;
        transition: all 0.3s ease;
    }
    
    .user-avatar-placeholder:hover {
        transform: scale(1.1);
        box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);
    }
    
    .user-info h3 {
        color: var(--text-primary);
        margin: 0 0 0.5rem 0;
        font-size: 1.3rem;
        font-weight: 600;
    }
    
    .user-meta {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .meta-item {
        display: flex;
        align-items: center;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }
    
    .meta-item i {
        color: var(--primary-color);
        margin-right: 0.5rem;
        width: 16px;
    }
    
    .user-skills {
        margin-bottom: 1.5rem;
    }
    
    .skills-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
    }
    
    .skills-title i {
        color: var(--accent-color);
        margin-right: 0.5rem;
    }
    
    .skill-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .skill-tag {
        background: rgba(79, 70, 229, 0.1);
        color: var(--primary-color);
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        border: 1px solid rgba(79, 70, 229, 0.2);
        transition: all 0.3s ease;
    }
    
    .skill-tag:hover {
        background: rgba(79, 70, 229, 0.2);
        transform: translateY(-2px);
    }
    
    .user-stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding: 1rem;
        background: var(--bg-secondary);
        border-radius: 12px;
    }
    
    .stat-item {
        text-align: center;
    }
    
    .stat-number {
        font-size: 1.2rem;
        font-weight: 700;
        color: var(--primary-color);
        display: block;
    }
    
    .stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
    }
    
    .user-actions {
        display: flex;
        gap: 0.75rem;
    }
    
    .btn-action {
        flex: 1;
        padding: 0.75rem 1rem;
        border-radius: 12px;
        font-size: 0.9rem;
        font-weight: 600;
        text-decoration: none;
        text-align: center;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    
    .btn-action::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s ease;
    }
    
    .btn-action:hover::before {
        left: 100%;
    }
    
    .btn-primary-action {
        background: var(--gradient-primary);
        color: white;
    }
    
    .btn-primary-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        color: white;
    }
    
    .btn-outline-action {
        background: transparent;
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }
    
    .btn-outline-action:hover {
        background: var(--bg-secondary);
        transform: translateY(-2px);
        color: var(--text-primary);
    }
    
    .pagination-wrapper {
        display: flex;
        justify-content: center;
        margin-top: 3rem;
    }
    
    .pagination {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }
    
    .page-btn {
        padding: 0.75rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 12px;
        background: var(--bg-glass);
        backdrop-filter: blur(20px);
        color: var(--text-primary);
        text-decoration: none;
        transition: all 0.3s ease;
        font-weight: 500;
        min-width: 44px;
        text-align: center;
    }
    
    .page-btn:hover {
        background: var(--bg-secondary);
        transform: translateY(-2px);
        color: var(--text-primary);
    }
    
    .page-btn.active {
        background: var(--gradient-primary);
        color: white;
        border-color: var(--primary-color);
    }
    
    .page-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }
    
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(10px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 10000;
    }
    
    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid transparent;
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .no-results {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-secondary);
        grid-column: 1 / -1;
    }
    
    .no-results i {
        font-size: 4rem;
        color: var(--primary-color);
        margin-bottom: 1rem;
        opacity: 0.5;
    }
    
    .no-results h3 {
        color: var(--text-primary);
        margin-bottom: 1rem;
        font-size: 1.5rem;
    }
    
    .no-results p {
        font-size: 1.1rem;
        margin-bottom: 2rem;
    }
    
    .clear-filters-btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 12px;
        background: var(--gradient-primary);
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .clear-filters-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
    }
    
    /* List view styles */
    .user-card.list-view {
        display: flex;
        align-items: center;
        padding: 1.5rem;
        margin-bottom: 1rem;
    }
    
    .user-card.list-view .user-header {
        margin-bottom: 0;
        margin-right: 2rem;
        min-width: 200px;
    }
    
    .user-card.list-view .user-skills {
        flex: 1;
        margin-bottom: 0;
        margin-right: 2rem;
    }
    
    .user-card.list-view .user-actions {
        margin-left: auto;
        flex-direction: column;
        min-width: 150px;
    }
    
    @media (max-width: 1024px) {
        .users-grid {
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
        
        .search-row {
            grid-template-columns: 1fr;
        }
        
        .filters-row {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 768px) {
        .browse-container {
            padding: 1rem 0;
        }
        
        .browse-header,
        .search-filters-section {
            padding: 1.5rem;
        }
        
        .browse-title {
            font-size: 2rem;
        }
        
        .users-grid {
            grid-template-columns: 1fr;
        }
        
        .user-card {
            padding: 1.5rem;
        }
        
        .user-actions {
            flex-direction: column;
        }
        
        .user-card.list-view {
            flex-direction: column;
            text-align: center;
        }
        
        .user-card.list-view .user-header,
        .user-card.list-view .user-skills {
            margin-right: 0;
            margin-bottom: 1rem;
        }
        
        .user-card.list-view .user-actions {
            margin-left: 0;
            flex-direction: row;
        }
        
        .search-filters-section {
            position: static;
        }
    }
    
    /* Smooth scrolling */
    html {
        scroll-behavior: smooth;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: var(--bg-secondary);
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-color);
    }
</style>
{% endblock %}

{% block content %}
<div class="browse-container">
    <div class="container">
        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
        </div>
        
        <!-- Browse Header -->
        <div class="browse-header fade-in">
            <h1 class="browse-title">Discover Amazing People</h1>
            <p class="browse-subtitle">Connect with skilled individuals ready to share their knowledge and learn from you</p>
        </div>
        
        <!-- Search and Filters -->
        <div class="search-filters-section fade-in">
            <div class="search-row">
                <div class="search-input-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" 
                           class="search-input" 
                           id="searchInput" 
                           placeholder="Search by name, skills, or location..."
                           autocomplete="off">
                </div>
                <button class="search-btn" id="searchBtn">
                    <i class="fas fa-search me-2"></i>
                    Search
                </button>
            </div>
            
            <div class="filters-row">
                <div class="filter-group">
                    <label class="filter-label">Skill Category</label>
                    <select class="filter-select" id="skillFilter">
                        <option value="">All Skills</option>
                        <option value="programming">Programming</option>
                        <option value="design">Design</option>
                        <option value="languages">Languages</option>
                        <option value="music">Music</option>
                        <option value="sports">Sports & Fitness</option>
                        <option value="cooking">Cooking</option>
                        <option value="photography">Photography</option>
                        <option value="business">Business</option>
                        <option value="crafts">Arts & Crafts</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Availability</label>
                    <select class="filter-select" id="availabilityFilter">
                        <option value="">Any Time</option>
                        <option value="weekends">Weekends</option>
                        <option value="evenings">Evenings</option>
                        <option value="weekdays">Weekdays</option>
                        <option value="flexible">Flexible</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Location</label>
                    <select class="filter-select" id="locationFilter">
                        <option value="">Any Location</option>
                        <option value="online">Online Only</option>
                        <option value="local">Local Area</option>
                        <option value="remote">Remote Friendly</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Sort By</label>
                    <select class="filter-select" id="sortFilter">
                        <option value="newest">Newest Members</option>
                        <option value="rating">Highest Rated</option>
                        <option value="active">Most Active</option>
                        <option value="skills">Most Skills</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Results Info and View Toggle -->
        <div class="results-info fade-in">
            <div class="results-count" id="resultsCount">
                Found <strong>0</strong> amazing people ready to swap skills
            </div>
            <div class="view-toggle">
                <button class="view-btn active" id="gridViewBtn" title="Grid View">
                    <i class="fas fa-th"></i>
                </button>
                <button class="view-btn" id="listViewBtn" title="List View">
                    <i class="fas fa-list"></i>
                </button>
            </div>
        </div>
        
        <!-- Users Container -->
        <div class="users-grid" id="usersContainer">
            <!-- Users will be dynamically loaded here -->
        </div>
        
        <!-- Pagination -->
        <div class="pagination-wrapper">
            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be dynamically generated -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const skillFilter = document.getElementById('skillFilter');
        const availabilityFilter = document.getElementById('availabilityFilter');
        const locationFilter = document.getElementById('locationFilter');
        const sortFilter = document.getElementById('sortFilter');
        const usersContainer = document.getElementById('usersContainer');
        const resultsCount = document.getElementById('resultsCount');
        const pagination = document.getElementById('pagination');
        const gridViewBtn = document.getElementById('gridViewBtn');
        const listViewBtn = document.getElementById('listViewBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        
        // State management
        let currentPage = 1;
        let totalPages = 1;
        let isGridView = true;
        let currentFilters = {
            search: '',
            skill: '',
            availability: '',
            location: '',
            sort: 'newest'
        };
        
        // Sample user data (replace with actual API call)
        const sampleUsers = [
            {
                id: 1,
                name: "Alex Chen",
                location: "San Francisco, CA",
                avatar: null,
                skills: ["JavaScript", "React", "Node.js", "Python"],
                skillCategory: "programming",
                availability: "evenings",
                rating: 4.8,
                completedSwaps: 12,
                joinedDate: "2024-01-15",
                isOnline: true
            },
            {
                id: 2,
                name: "Maria Garcia",
                location: "Barcelona, Spain",
                avatar: null,
                skills: ["Graphic Design", "Photoshop", "Illustrator", "Figma"],
                skillCategory: "design",
                availability: "weekends",
                rating: 4.9,
                completedSwaps: 8,
                joinedDate: "2024-02-01",
                isOnline: false
            },
            {
                id: 3,
                name: "David Kim",
                location: "Seoul, Korea",
                avatar: null,
                skills: ["Python", "Machine Learning", "Data Science", "AI"],
                skillCategory: "programming",
                availability: "flexible",
                rating: 4.7,
                completedSwaps: 15,
                joinedDate: "2024-01-08",
                isOnline: true
            },
            {
                id: 4,
                name: "Sophie Wilson",
                location: "London, UK",
                avatar: null,
                skills: ["French", "Spanish", "Italian", "German"],
                skillCategory: "languages",
                availability: "weekdays",
                rating: 5.0,
                completedSwaps: 20,
                joinedDate: "2023-12-20",
                isOnline: true
            },
            {
                id: 5,
                name: "Carlos Rodriguez",
                location: "Mexico City, Mexico",
                avatar: null,
                skills: ["Guitar", "Music Theory", "Songwriting", "Piano"],
                skillCategory: "music",
                availability: "evenings",
                rating: 4.6,
                completedSwaps: 6,
                joinedDate: "2024-02-10",
                isOnline: false
            },
            {
                id: 6,
                name: "Priya Patel",
                location: "Mumbai, India",
                avatar: null,
                skills: ["Yoga", "Meditation", "Wellness", "Nutrition"],
                skillCategory: "sports",
                availability: "weekends",
                rating: 4.9,
                completedSwaps: 11,
                joinedDate: "2024-01-25",
                isOnline: true
            },
            {
                id: 7,
                name: "Emma Thompson",
                location: "Toronto, Canada",
                avatar: null,
                skills: ["Photography", "Photo Editing", "Lightroom", "Camera"],
                skillCategory: "photography",
                availability: "flexible",
                rating: 4.8,
                completedSwaps: 9,
                joinedDate: "2024-02-05",
                isOnline: false
            },
            {
                id: 8,
                name: "Ahmed Hassan",
                location: "Dubai, UAE",
                avatar: null,
                skills: ["Arabic", "English", "Business", "Marketing"],
                skillCategory: "business",
                availability: "weekdays",
                rating: 4.7,
                completedSwaps: 14,
                joinedDate: "2024-01-12",
                isOnline: true
            },
            {
                id: 9,
                name: "Lisa Anderson",
                location: "Sydney, Australia",
                avatar: null,
                skills: ["Cooking", "Baking", "Pastry", "Nutrition"],
                skillCategory: "cooking",
                availability: "weekends",
                rating: 4.9,
                completedSwaps: 7,
                joinedDate: "2024-02-15",
                isOnline: true
            },
            {
                id: 10,
                name: "Jean-Pierre Dubois",
                location: "Paris, France",
                avatar: null,
                skills: ["Painting", "Drawing", "Art History", "Sculpture"],
                skillCategory: "crafts",
                availability: "evenings",
                rating: 4.8,
                completedSwaps: 13,
                joinedDate: "2024-01-30",
                isOnline: false
            },
            {
                id: 11,
                name: "Yuki Tanaka",
                location: "Tokyo, Japan",
                avatar: null,
                skills: ["Japanese", "Calligraphy", "Origami", "Tea Ceremony"],
                skillCategory: "languages",
                availability: "flexible",
                rating: 5.0,
                completedSwaps: 18,
                joinedDate: "2023-12-15",
                isOnline: true
            },
            {
                id: 12,
                name: "Roberto Silva",
                location: "São Paulo, Brazil",
                avatar: null,
                skills: ["Portuguese", "Capoeira", "Dance", "Music"],
                skillCategory: "sports",
                availability: "evenings",
                rating: 4.6,
                completedSwaps: 5,
                joinedDate: "2024-02-20",
                isOnline: false
            }
        ];
        
        // Function to create user card HTML
        function createUserCard(user, viewType = 'grid') {
            const avatar = user.avatar 
                ? `<img src="${user.avatar}" alt="${user.name}" class="user-avatar">`
                : `<div class="user-avatar-placeholder">${user.name[0]}</div>`;
            
            const skillTags = user.skills.slice(0, 4).map(skill => 
                `<span class="skill-tag">${skill}</span>`
            ).join('');
            
            const moreSkills = user.skills.length > 4 ? `<span class="skill-tag">+${user.skills.length - 4} more</span>` : '';
            
            const onlineStatus = user.isOnline ? 
                '<i class="fas fa-circle" style="color: #10b981; font-size: 0.6rem;"></i> Online' :
                '<i class="fas fa-circle" style="color: #6b7280; font-size: 0.6rem;"></i> Offline';
            
            return `
                <div class="user-card glow-card ${viewType === 'list' ? 'list-view' : ''}" data-user-id="${user.id}">
                    <div class="user-header">
                        ${avatar}
                        <div class="user-info">
                            <h3>${user.name}</h3>
                            <div class="user-meta">
                                <div class="meta-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    ${user.location}
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-clock"></i>
                                    ${user.availability.charAt(0).toUpperCase() + user.availability.slice(1)}
                                </div>
                                <div class="meta-item">
                                    ${onlineStatus}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="user-skills">
                        <div class="skills-title">
                            <i class="fas fa-star"></i>
                            Skills Offered
                        </div>
                        <div class="skill-tags">
                            ${skillTags}
                            ${moreSkills}
                        </div>
                    </div>
                    
                    <div class="user-stats">
                        <div class="stat-item">
                            <span class="stat-number">${user.rating}</span>
                            <div class="stat-label">Rating</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">${user.completedSwaps}</span>
                            <div class="stat-label">Swaps</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">${user.skills.length}</span>
                            <div class="stat-label">Skills</div>
                        </div>
                    </div>
                    
                    <div class="user-actions">
                        <button class="btn-action btn-primary-action" onclick="requestSwap(${user.id})">
                            <i class="fas fa-handshake"></i>
                            Request Swap
                        </button>
                        <button class="btn-action btn-outline-action" onclick="viewProfile(${user.id})">
                            <i class="fas fa-eye"></i>
                            View Profile
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Function to filter and sort users
        function filterUsers() {
            let filtered = [...sampleUsers];
            
            // Apply search filter
            if (currentFilters.search) {
                const searchTerm = currentFilters.search.toLowerCase();
                filtered = filtered.filter(user => 
                    user.name.toLowerCase().includes(searchTerm) ||
                    user.location.toLowerCase().includes(searchTerm) ||
                    user.skills.some(skill => skill.toLowerCase().includes(searchTerm))
                );
            }
            
            // Apply skill category filter
            if (currentFilters.skill) {
                filtered = filtered.filter(user => 
                    user.skillCategory === currentFilters.skill
                );
            }
            
            // Apply availability filter
            if (currentFilters.availability) {
                filtered = filtered.filter(user => 
                    user.availability === currentFilters.availability
                );
            }
            
            // Apply location filter
            if (currentFilters.location) {
                if (currentFilters.location === 'online') {
                    filtered = filtered.filter(user => user.isOnline);
                } else if (currentFilters.location === 'local') {
                    // Simulate local filtering (you would implement actual geolocation logic)
                    filtered = filtered.filter(user => user.location.includes('CA'));
                }
            }
            
            // Apply sorting
            switch (currentFilters.sort) {
                case 'rating':
                    filtered.sort((a, b) => b.rating - a.rating);
                    break;
                case 'active':
                    filtered.sort((a, b) => b.completedSwaps - a.completedSwaps);
                    break;
                case 'skills':
                    filtered.sort((a, b) => b.skills.length - a.skills.length);
                    break;
                case 'newest':
                default:
                    filtered.sort((a, b) => new Date(b.joinedDate) - new Date(a.joinedDate));
                    break;
            }
            
            return filtered;
        }
        
        // Function to display users with pagination
        function displayUsers(page = 1) {
            showLoading();
            
            setTimeout(() => {
                const filteredUsers = filterUsers();
                const usersPerPage = 10;
                const startIndex = (page - 1) * usersPerPage;
                const endIndex = startIndex + usersPerPage;
                const usersToShow = filteredUsers.slice(startIndex, endIndex);
                
                // Update results count
                resultsCount.innerHTML = `Found <strong>${filteredUsers.length}</strong> amazing people ready to swap skills`;
                
                // Clear container
                usersContainer.innerHTML = '';
                
                if (usersToShow.length === 0) {
                    usersContainer.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-search"></i>
                            <h3>No users found</h3>
                            <p>Try adjusting your search criteria or filters to find more people.</p>
                            <button class="clear-filters-btn" onclick="clearAllFilters()">
                                Clear All Filters
                            </button>
                        </div>
                    `;
                } else {
                    // Update container class based on view type
                    usersContainer.className = isGridView ? 'users-grid' : 'users-list';
                    
                    // Add users with staggered animation
                    usersToShow.forEach((user, index) => {
                        setTimeout(() => {
                            const userElement = document.createElement('div');
                            userElement.innerHTML = createUserCard(user, isGridView ? 'grid' : 'list');
                            const userCard = userElement.firstElementChild;
                            
                            usersContainer.appendChild(userCard);
                            
                            // Trigger animation
                            setTimeout(() => {
                                userCard.classList.add('visible');
                            }, 50);
                        }, index * 100);
                    });
                }
                
                // Update pagination
                totalPages = Math.ceil(filteredUsers.length / usersPerPage);
                currentPage = page;
                updatePagination();
                
                hideLoading();
            }, 500);
        }
        
        // Function to update pagination
        function updatePagination() {
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => changePage(currentPage - 1);
            pagination.appendChild(prevBtn);
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            if (startPage > 1) {
                const firstBtn = createPageButton(1);
                pagination.appendChild(firstBtn);
                
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'page-btn';
                    ellipsis.style.border = 'none';
                    ellipsis.style.background = 'transparent';
                    pagination.appendChild(ellipsis);
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = createPageButton(i);
                pagination.appendChild(pageBtn);
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.className = 'page-btn';
                    ellipsis.style.border = 'none';
                    ellipsis.style.background = 'transparent';
                    pagination.appendChild(ellipsis);
                }
                
                const lastBtn = createPageButton(totalPages);
                pagination.appendChild(lastBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => changePage(currentPage + 1);
            pagination.appendChild(nextBtn);
        }
        
        // Function to create page button
        function createPageButton(pageNum) {
            const btn = document.createElement('button');
            btn.className = `page-btn ${pageNum === currentPage ? 'active' : ''}`;
            btn.textContent = pageNum;
            btn.onclick = () => changePage(pageNum);
            return btn;
        }
        
        // Function to change page
        function changePage(page) {
            if (page < 1 || page > totalPages || page === currentPage) return;
            
            // Smooth scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            setTimeout(() => {
                displayUsers(page);
            }, 300);
        }
        
        // Function to show loading
        function showLoading() {
            loadingOverlay.style.display = 'flex';
        }
        
        // Function to hide loading
        function hideLoading() {
            loadingOverlay.style.display = 'none';
        }
        
        // Function to update filters and refresh results
        function updateFilters() {
            currentFilters.search = searchInput.value.trim();
            currentFilters.skill = skillFilter.value;
            currentFilters.availability = availabilityFilter.value;
            currentFilters.location = locationFilter.value;
            currentFilters.sort = sortFilter.value;
            
            displayUsers(1);
        }
        
        // Event listeners
        searchInput.addEventListener('input', window.SkillSwap.debounce(updateFilters, 300));
        searchBtn.addEventListener('click', updateFilters);
        skillFilter.addEventListener('change', updateFilters);
        availabilityFilter.addEventListener('change', updateFilters);
        locationFilter.addEventListener('change', updateFilters);
        sortFilter.addEventListener('change', updateFilters);
        
        // View toggle event listeners
        gridViewBtn.addEventListener('click', function() {
            if (!isGridView) {
                isGridView = true;
                this.classList.add('active');
                listViewBtn.classList.remove('active');
                displayUsers(currentPage);
            }
        });
        
        listViewBtn.addEventListener('click', function() {
            if (isGridView) {
                isGridView = false;
                this.classList.add('active');
                gridViewBtn.classList.remove('active');
                displayUsers(currentPage);
            }
        });
        
        // Global functions for user interactions
        window.requestSwap = function(userId) {
            const button = event.target;
            const originalHTML = button.innerHTML;
            button.innerHTML = '<span class="loading"></span> Requesting...';
            button.disabled = true;
            
            setTimeout(() => {
                window.location.href = `/swap_request/${userId}`;
            }, 1000);
        };
        
        window.viewProfile = function(userId) {
            const card = event.target.closest('.user-card');
            card.style.opacity = '0.7';
            
            setTimeout(() => {
                window.location.href = `/public_profile/${userId}`;
            }, 200);
        };
        
        window.clearAllFilters = function() {
            searchInput.value = '';
            skillFilter.value = '';
            availabilityFilter.value = '';
            locationFilter.value = '';
            sortFilter.value = 'newest';
            updateFilters();
        };
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + K for search focus
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                searchInput.focus();
            }
            
            // Escape to clear search
            if (e.key === 'Escape' && document.activeElement === searchInput) {
                searchInput.value = '';
                updateFilters();
            }
            
            // Arrow keys for pagination
            if (e.key === 'ArrowLeft' && currentPage > 1) {
                changePage(currentPage - 1);
            }
            if (e.key === 'ArrowRight' && currentPage < totalPages) {
                changePage(currentPage + 1);
            }
        });
        
        // Initialize
        displayUsers(1);
        
        // Auto-focus search input
        searchInput.focus();
    });
</script>
{% endblock %}